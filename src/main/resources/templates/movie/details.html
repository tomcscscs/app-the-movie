<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragment/template :: head}">
</head>
<body>
	<div class="bg-dark text-white" style="min-height: 100vh">
		<div th:replace="~{fragment/template :: header}"></div>
		<div class="px-5 position-relative">
			<div class="px-5 d-flex align-items-center"
				style="height: 450px; background-size: cover; "
				th:styleappend="|background-image : url(@{https://image.tmdb.org/t/p/original{path}(path=${movie.backdropPath})})|">
				<div style="z-index: 2">
					<img
						th:src="@{https://image.tmdb.org/t/p/w500{path}(path=${movie.posterPath})}"
						style="height: 400px" class="rounded-4" />
				</div>
				<div>설명충</div>
			</div>
			<div th:if="${session.logonUser != null}" class="py-2" >
				<span> 
					<i class="bi " 
						th:classappend="${favorited ? 'bi-heart-fill' : 'bi-heart'}" id="fav-bt" th:data-target="${movie.id}"></i>
				</span>
			</div>
		</div>
	</div>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script>
		/*
			document.querySelector("#fav-bt").addEventListener("click", function() {
				
			});
		 */
		$("#fav-bt").on("click", function(evt) {
			// document.querySelector("#fav-bt").dataSet.target
			const target = $("#fav-bt").data("target");
			if($(this).hasClass("bi-heart")) {	// 비어있는 하트상태일때 (미등록 즐겨찾기 일때)
				$.ajax({
					url : "/movie/favorite/"+target,
					method : "post",
					dataType: "json"
				}).done(function(response){
					 // console.log(typeof response, response);
					 // const obj = JSON.parse(text);
					 console.log(response);
					if(response.result) {
						$("#fav-bt").removeClass("bi-heart");
						$("#fav-bt").addClass("bi-heart-fill");
					}else {
						window.alert(response.cause);
					}
				});
				
			}else { // 그렇지 않을때
				
				$.ajax({
					url : "/movie/favorite/"+target,
					method : "delete",
					dataType: "json"
				}).done(function(response){
					 // console.log(typeof response, response);
					 // const obj = JSON.parse(text);
					 console.log(response);
					if(response.result) {
						$("#fav-bt").toggleClass("bi-heart");
						$("#fav-bt").toggleClass("bi-heart-fill");
					}else {
						window.alert(response.cause);
					}
				});
				
				
				
				
				
			}
		});
	</script>
</body>
</html>